{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Bulk Upload Sheet Music{% endblock %}

{% block content %}
<h1>Bulk Upload Sheet Music</h1>
<p>Upload sheet music for multiple hymns at once. You can use either file uploads or external URLs.</p>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <fieldset class="module aligned">
        <div class="form-row">
            <div>
                <label for="files">Upload PDF Files (Optional):</label>
                <input type="file" name="files" id="files" multiple accept=".pdf,application/pdf">
                <p class="help">
                    Upload PDF files directly. Filenames should contain hymn numbers (e.g., <code>101-sheet.pdf</code> or <code>hymn_102.pdf</code>).<br>
                    The system will automatically extract hymn numbers from filenames.
                </p>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="hymns_data">Or Enter URLs (Optional):</label>
                <textarea name="hymns_data" id="hymns_data" rows="10" style="width: 100%; font-family: monospace;" placeholder="Format: hymn_id|file_url|thumbnail_url|page_count&#10;Example:&#10;1|https://drive.google.com/file/...|https://drive.google.com/thumbnail/...|2&#10;2|https://dropbox.com/s/...||1"></textarea>
                <p class="help">
                    <strong>Format:</strong> One entry per line<br>
                    <strong>Structure:</strong> hymn_id|file_url|thumbnail_url|page_count<br>
                    <strong>Examples:</strong><br>
                    • Full: <code>1|https://drive.google.com/file/...|https://thumbnail.url|2</code><br>
                    • Minimal: <code>2|https://example.com/sheet.pdf</code> (thumbnail and page_count optional)<br>
                    <strong>Note:</strong> You can use either file uploads OR URLs, or both together.
                </p>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label>
                    <input type="checkbox" name="is_premium" id="is_premium" checked>
                    Mark as Premium Content
                </label>
                <p class="help">Check this to mark all uploaded sheet music as premium content</p>
            </div>
        </div>
    </fieldset>
    
    <div class="submit-row">
        <input type="submit" value="Upload Sheet Music" class="default">
        <a href="{% url 'admin:hymns_sheetmusic_changelist' %}" class="button">Cancel</a>
    </div>
</form>

<div style="margin-top: 30px; padding: 20px; background: #f8f8f8; border-radius: 5px;">
    <h3>Quick Reference - Hymn IDs:</h3>
    <div style="max-height: 300px; overflow-y: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #e0e0e0;">
                    <th style="padding: 8px; border: 1px solid #ccc;">ID</th>
                    <th style="padding: 8px; border: 1px solid #ccc;">Number</th>
                    <th style="padding: 8px; border: 1px solid #ccc;">Title</th>
                </tr>
            </thead>
            <tbody>
                {% for hymn in hymns %}
                <tr>
                    <td style="padding: 8px; border: 1px solid #ccc;">{{ hymn.id }}</td>
                    <td style="padding: 8px; border: 1px solid #ccc;">{{ hymn.number }}</td>
                    <td style="padding: 8px; border: 1px solid #ccc;">{{ hymn.title|truncatewords:10 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% if hymns|length >= 100 %}
        <p style="margin-top: 10px; font-style: italic;">Showing first 100 hymns. Use the search in the main admin to find others.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

